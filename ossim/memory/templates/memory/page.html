<!DOCTYPE html>
<html>
<head>
  <title>
    Page Replacement
  </title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>


<style>

</style>
<body>
  <h1>
    Page replacement
  </h1>
  <br>
  <br>
  <div id="input">
    Requests:
     <input type="text" class="requests" placeholder="Enter requests"></input>
     Cache Size:
      <input type="text" class="size" placeholder="Enter cache size"></input>
      <button id="submit">Submit</button>
  </div>
  <div>
  <button id="proceed" class="hidden">Proceed</button>
  </div>
	<div id="result">

  </div>
</body>
</html>

<script>


var count= 0;
var cacheSize = 3;
var data = [1,3,2,1,2,4,5,2]
var cache;
var states;
var hits;
var misses;
var hitratio;

$("#submit").click(function(){
    data = $(".requests").val().trim().split(" ");
    cacheSize = parseInt($(".size").val().trim());
    count = 0;
    $("#result").empty();

    var reqs = JSON.stringify(data.map(Number));
    var csize = JSON.stringify(cacheSize);
    $.post('/memory/fifo/',{requests: reqs, size: csize}, function(result){

      cache = result;
      states = cache["states"];
      hits = cache["hits"];
      misses = cache["miss"];
      hitratio = cache["hit-ratio"];
      $("#proceed").removeClass("hidden");
    });



});

function drawCard(){
var i,j;
var input = document.getElementById("input");
var result = document.getElementById("result");
if(count ==0){
var card = document.createElement("div");
card.setAttribute("class", "card");



var div = document.createElement("div");
div.setAttribute("class", "request");
div.innerHTML = "Request :";
card.appendChild(div);
for(j=0;j<cacheSize;++j){
  var div1 = document.createElement("div");
  div1.innerHTML = "Cache[" + j + "]";
  card.appendChild(div1);
}

var div0 = document.createElement("div");
div0.setAttribute("class", "hitmiss status");
div0.innerHTML = "Status : ";
card.appendChild(div0);

$(card).hide().appendTo("#result").fadeIn(1000);
}
  i = count;
  var card = document.createElement("div");
  card.setAttribute("class", "card");
  var tempCache = states[i]["cache"].split(" ");



  var div = document.createElement("div");
  div.setAttribute("class", "request");
  div.innerHTML = data[i];
  card.appendChild(div);
  for(j=0;j<cacheSize;++j){
    var div1 = document.createElement("div");
    if(tempCache[j] == "-1") div1.innerHTML = "-"
    else div1.innerHTML = tempCache[j];
    card.appendChild(div1);
  }

  var div0 = document.createElement("div");
  div0.setAttribute("class", "hitmiss");
  if(states[i]["status"] == 'H'){
    div0.innerHTML = "&#x2714;";
    div0.className +=" hit";
  }
  else{
    div0.innerHTML = "&#x2716;";
    div0.className +=" miss";
  }
  card.appendChild(div0);

  $(card).hide().appendTo("#result").fadeIn(1000);
  //result.appendChild(card);
  count++;
}

$("#proceed").click(function(){
  drawCard();
  if(count == data.length){
    $("#proceed").addClass("hidden");
     div0 = document.createElement("div");
     div0.setAttribute("id", "answers");
     div0.innerHTML = "HITS: "+ hits + "<br>MISSES: "+misses + "<br>HIT RATIO: "+hitratio;
     br = document.createElement("br");
     input.appendChild(br);
     input.appendChild(br);
     $(div0).hide().appendTo("#input").fadeIn(1000);
    
  }

});

</script>

<style>
#result{
  margin-top: 25px;
}
#proceed{
  margin: 10px;
}
#input{
  margin: 10px;
}
.card{
  position: relative;
  border: 1px solid black;
  float: left;
  text-align: center;
  width:100px;
  margin-left: 10px;
}
.request{
  border-bottom:  1px solid black;
  margin-bottom: 10px;
}

.hitmiss{
  margin-top: 10px;
  border-top: 1px solid black;
  color: white;
}
.hit{
  background-color: green;
}
.miss{
  background-color: red;
}

.status{
  color: black;
}
.hidden{
  display:none;
}

#answers{
  display:block;
}
.ans{
  text-transform: capitalize;


}
</style>
